<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/DAME-FLAME-Python-Package/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/DAME-FLAME-Python-Package/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/DAME-FLAME-Python-Package/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/DAME-FLAME-Python-Package/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Getting Matches | AME Lab</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Getting Matches" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Getting Matches from the Data" /> <meta property="og:description" content="Getting Matches from the Data" /> <link rel="canonical" href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/Getting-Matches" /> <meta property="og:url" content="http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/Getting-Matches" /> <meta property="og:site_name" content="AME Lab" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2020-11-07T13:12:32-06:00" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/Getting-Matches","datePublished":"2020-11-07T13:12:32-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/Getting-Matches"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/DAME-FLAME-Python-Package/content/logos/logo.svg"}},"headline":"Getting Matches","description":"Getting Matches from the Data","dateModified":"2020-11-07T13:12:32-06:00","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/DAME-FLAME-Python-Package/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <div class="nav-category">DAME-FLAME Python Package</div> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/DAME-FLAME-Python-Package/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="http://localhost:4000/DAME-FLAME-Python-Package/getting-started" class="nav-list-link">Getting Started</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation" class="nav-list-link">Documentation</a><ul class="nav-list "><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/api-documentation/" class="nav-list-link">API Documentation</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/api-documentation/DAME" class="nav-list-link">DAME</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/api-documentation/FLAME" class="nav-list-link">FLAME</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/api-documentation/matched-group" class="nav-list-link">Matched Group</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/api-documentation/ATE" class="nav-list-link">ATE</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/api-documentation/CATE" class="nav-list-link">CATE</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/api-documentation/ATT" class="nav-list-link">ATT</a> </li></ul></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide" class="nav-list-link">User Guide</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/Introduction" class="nav-list-link">Introduction to Causal Inference</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/to-match-or-not" class="nav-list-link">Whether to use Matching</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/data-requirements" class="nav-list-link">Discrete Observation Requirement</a></li><li class="nav-list-item active"><a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/Getting-Matches" class="nav-list-link active">Getting Matches</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/Treatment-Effects" class="nav-list-link">Treatment Effect Estimates</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/Algorithm-Controls" class="nav-list-link">Algorithm Controls</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/Missing-Data" class="nav-list-link">Missing Data Handling</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples" class="nav-list-link">Examples</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/flame_vs_dame_quality/" class="nav-list-link">Comparing DAME and FLAME</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/early_stopping/" class="nav-list-link">Benefit to Early Stopping</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/exact_matching/" class="nav-list-link">Exact Matching Only</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/interpretability/" class="nav-list-link">Interpreting Covariate Importance</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/DAME-FLAME-Python-Package/FAQ" class="nav-list-link">FAQ and Vocabulary Guide</a></li></ul> </nav> <footer class="site-footer"> This package is created by the <a href="https://almost-matching-exactly.github.io">Almost Matching Exactly Lab</a>. Our site is based on the Jekyll theme <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AME Lab" aria-label="Search AME Lab" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/almost-matching-exactly" class="site-button" rel="noopener noreferrer" > GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide">Documentation</a></li> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/Getting-Matches">User Guide</a></li> <li class="breadcrumb-nav-list-item"><span>Getting Matches</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="no_toc" id="getting-matches-from-the-data"> <a href="#getting-matches-from-the-data" class="anchor-heading" aria-labelledby="getting-matches-from-the-data"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting Matches from the Data </h1> <details open=""> <summary class="text-delta"> Table of contents </summary> <ol id="markdown-toc"> <li><a href="#flame" id="markdown-toc-flame">FLAME</a></li> <li><a href="#dame" id="markdown-toc-dame">DAME</a></li> <li><a href="#variations-in-the-learning-of-the-best-covariate-set" id="markdown-toc-variations-in-the-learning-of-the-best-covariate-set">Variations in the learning of the best covariate set</a></li> </ol> </details> <h2 id="flame"> <a href="#flame" class="anchor-heading" aria-labelledby="flame"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> FLAME </h2> <p>FLAME stands for <em>Fast Large Scale Almost Matching Exactly</em>. The FLAME algorithm begins by matching any units that can be matched exactly on all covariates. The algorithm will iterate over all covariates until stopping criteria is reached. In each iteration, the algorithm will drop the worst covariate set to match on, and units that have identical values in all of the remaining covariates will form a matched group. When deciding which covariate should be dropped, at each step, it drops the covariate leading to the smallest drop in match quality, MQ, defined as MQ=C·BF−PE. Here, PE denotes the predictive error, which measures how important the dropped covariate is for predicting the outcome on the holdout dataset, using a machine learning algorithm. The balancing factor, BF, measures the number of matches formed by dropping that covariate and the discrepancy between the number of treated and control units after the matching. In future iterations, the covariate that was determined worst and was just dropped will not reappear, so the maximum number of times the algorithm will iterate is equal to the number of covariates. For more details on this algorithm, see <a href="#references">[1]</a>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">dame_flame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"dame_flame/data/sample.csv"</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dame_flame</span><span class="p">.</span><span class="n">matching</span><span class="p">.</span><span class="n">FLAME</span><span class="p">(</span><span class="n">repeats</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">early_stop_iterations</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">holdout_data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1">#&gt;    x1   x2   x3   x4
#&gt; 0   0   1    1    *     
#&gt; 1   0   1    1    *     
#&gt; 2   1   0    *    1     
#&gt; 3   1   0    *    1     
</span></code></pre></div></div> <h2 id="dame"> <a href="#dame" class="anchor-heading" aria-labelledby="dame"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DAME </h2> <p>DAME stands for <em>Dynamic Almost Matching Exactly</em>. The algorithm begins by matching any units that can be matched exactly on all co-variates. The algorithm will iterate over options of covariates to match on until stopping criteria is reached. In each iteration, the algorithm will select the best covariate set to match on, and units that have identical values in all of the covariates that are part of the chosen covariate set will form a matched group. In its options of covariate sets to drop, DAME will always include the largest possible covariate sets, and will ultimately consider several combinations of covariates before selecting one to match on. It defines the best covariate set as the one that minimizes PE. PE is predictive error, and measures how important the covariate set is for predicting the outcome on the holdout dataset, using a machine learning algorithm. For more details on this algorithm, see <a href="#references">[2]</a>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">dame_flame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"dame_flame/data/sample.csv"</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dame_flame</span><span class="p">.</span><span class="n">matching</span><span class="p">.</span><span class="n">DAME</span><span class="p">(</span><span class="n">repeats</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">early_stop_iterations</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">holdout_data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="c1">#&gt;    x1   x2   x3   x4
#&gt; 0   0   1    1    *     
#&gt; 1   0   1    1    *     
#&gt; 2   1   0    *    1     
#&gt; 3   1   0    *    1     
</span></code></pre></div></div> <h2 id="variations-in-the-learning-of-the-best-covariate-set"> <a href="#variations-in-the-learning-of-the-best-covariate-set" class="anchor-heading" aria-labelledby="variations-in-the-learning-of-the-best-covariate-set"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variations in the learning of the best covariate set </h2> <p>Both the FLAME and DAME algorithms choose the best covariate set after measuring how important each covariate set is for predicting the outcome on the holdout dataset, using a machine learning algorithm. We offer different options for the machine learning algorithm used, as well as a simplified FLAME and simplified DAME that does not use machine learning. We use scikit-learn for the underlying learning algorithms, so we refer you to their documentation and references to learn more about these popular machine learning algorithms, as well as their specific implementations. For examples of categorical, binary, and numerical data, see <a href="#references">[3]</a>.</p> <div class="table-wrapper"><table> <thead> <tr> <th>Learning Method</th> <th>Technical Details</th> <th>Usage Recommendation</th> <th>Algorithm parameter</th> </tr> </thead> <tbody> <tr> <td>Ridge Regression</td> <td>A ridge regression is similar to an ordinary least squares regression, but it imposes a penalty on the size of coefficients. It minimizes a residual sum of squares. A shrinkage parameter, $\alpha$ must be included. We use an implementation provided by scikit-learn <a href="#references">[4]</a>.</td> <td>This can only be used when it is certain that none of the covariates are categorical. Ordinal, binary, and discrete numerical data is all accepted. For this option, a larger $\alpha$ corresponds should be chosen if it is believed that there is greater multicollinearity in the data, meaning that many covariates are linearly correlated.</td> <td><code class="language-plaintext highlighter-rouge">adaptive_weights='ridge'</code></td> </tr> <tr> <td>Ridge Regression CV</td> <td>This is a ridge regression with built-in cross validation to determine the best $\alpha$ parameter. We use the scikit-learn ridgeCV class, but the default array of $\alpha$ options that we provide the function to iterate over is larger than the default they provide, for greater flexibility <a href="#references">[5]</a>.</td> <td>This also can only be used when it is certain that none of the covariates are categorical. Ordinal, binary and discrete numerical data is all accepted. This option is advantageous over the ‘ridge’ option without cross validation in a case where a user is uncertain about the $\alpha$ parameter, and a minor speed decrease from cross validation is acceptable.</td> <td><code class="language-plaintext highlighter-rouge">adaptive_weights='ridgeCV'</code></td> </tr> <tr> <td>Decision Tree</td> <td>The underlying implementation is the Decision Tree Regression provided by scikit-learn, which uses a variation of CART <a href="#references">[6]</a>. Trees predict the value of the outcome by learning decision rules from the covariates.</td> <td>This can be used for categorical, ordinal, binary, and discrete numerical data. Overfitting is a risk with decision tree models, which can be possible in DAME or FLAME algorithm if the holdout and input datasets provided are the same.</td> <td><code class="language-plaintext highlighter-rouge">adaptive_weights='decision-tree'</code></td> </tr> </tbody> </table></div> <div id="references" class="language-markdown highlighter-rouge"> <h4> References </h4> <a class="number" href="#flame">[1]</a> <a href="https://arxiv.org/abs/1707.06315"> Wang, Morucci, et al. <i>FLAME: A Fast Large-scale Almost Matching Exactly Approach to Causal Inference</i>. </a> <br /> <a class="number" href="#dame">[2]</a> <a href="https://arxiv.org/abs/1806.06802"> Liu, Dieng, et al. <i>Interpretable Almost Matching Exactly For Causal Inference</i>. </a> <br /> <a class="number" href="#variations-in-the-learning-of-the-best-covariate-set">[3]</a> <a href="https://stats.idre.ucla.edu/other/mult-pkg/whatstat/what-is-the-difference-between-categorical-ordinal-and-numerical-variables/"> What is the Difference Between Categorical, Ordinal, and Numerical Variables? UCLA: Statistical Consulting Group. </a> <br /> <a class="number" href="#variations-in-the-learning-of-the-best-covariate-set">[4]</a> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html"> Scikit-learn Ridge Regressions </a> <br /> <a class="number" href="#variations-in-the-learning-of-the-best-covariate-set">[5]</a> <a href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html"> Scikit-learn RidgeCV </a> <br /> <a class="number" href="#variations-in-the-learning-of-the-best-covariate-set">[6]</a> <a href="https://scikit-learn.org/stable/modules/tree.html#tree"> Scikit-learn DecisionTree </a> </div> </div> </div> <div class="search-overlay"></div> </div> </body> </html> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true } }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
