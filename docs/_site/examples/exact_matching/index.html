<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <link rel="shortcut icon" href="/DAME-FLAME-Python-Package/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/DAME-FLAME-Python-Package/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/DAME-FLAME-Python-Package/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/DAME-FLAME-Python-Package/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Exact Matching Only | AME Lab</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="Exact Matching Only" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Exact Matching The DAME or FLAME algorithm can be configured to be used for exact matching, using the early stopping criteria parameter early_stop_iterations=1. We illustrate this below. On a dataset with 200 units and five covariates that was generated with little randomness in which most covariate values are the same, we are only interested in exactly matched units. The output generated by the verbose=3 parameter shows that the majority of units are matched after one iteration. We visualize the treatment effect of each group, or the CATE of each group, using matplotlib [1]. We also visualize the matched groups’ sizes, which shows that one group has the majority of units." /> <meta property="og:description" content="Exact Matching The DAME or FLAME algorithm can be configured to be used for exact matching, using the early stopping criteria parameter early_stop_iterations=1. We illustrate this below. On a dataset with 200 units and five covariates that was generated with little randomness in which most covariate values are the same, we are only interested in exactly matched units. The output generated by the verbose=3 parameter shows that the majority of units are matched after one iteration. We visualize the treatment effect of each group, or the CATE of each group, using matplotlib [1]. We also visualize the matched groups’ sizes, which shows that one group has the majority of units." /> <link rel="canonical" href="http://localhost:4000/DAME-FLAME-Python-Package/examples/exact_matching/" /> <meta property="og:url" content="http://localhost:4000/DAME-FLAME-Python-Package/examples/exact_matching/" /> <meta property="og:site_name" content="AME Lab" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2020-11-30T21:43:10-06:00" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"http://localhost:4000/DAME-FLAME-Python-Package/examples/exact_matching/","datePublished":"2020-11-30T21:43:10-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/DAME-FLAME-Python-Package/examples/exact_matching/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/DAME-FLAME-Python-Package/content/logos/logo.svg"}},"headline":"Exact Matching Only","description":"Exact Matching The DAME or FLAME algorithm can be configured to be used for exact matching, using the early stopping criteria parameter early_stop_iterations=1. We illustrate this below. On a dataset with 200 units and five covariates that was generated with little randomness in which most covariate values are the same, we are only interested in exactly matched units. The output generated by the verbose=3 parameter shows that the majority of units are matched after one iteration. We visualize the treatment effect of each group, or the CATE of each group, using matplotlib [1]. We also visualize the matched groups’ sizes, which shows that one group has the majority of units.","dateModified":"2020-11-30T21:43:10-06:00","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/DAME-FLAME-Python-Package/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <div class="nav-category">DAME-FLAME Python Package</div> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/DAME-FLAME-Python-Package/" class="nav-list-link">Home</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/getting-started" class="nav-list-link">Getting Started</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/getting-started/installation_example/" class="nav-list-link">Installation and Quickstart Example</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/getting-started/contributing_guide/" class="nav-list-link">Contributing Guide</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/api-documentation" class="nav-list-link">API Documentation</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/api-documentation/DAME" class="nav-list-link">DAME</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/api-documentation/FLAME" class="nav-list-link">FLAME</a></li><li class="nav-list-item "><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/api-documentation/post-processing/" class="nav-list-link">Post Processing</a><ul class="nav-list"><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/api-documentation/post-processing/matched-group" class="nav-list-link">Matched Group</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/api-documentation/post-processing/ATE" class="nav-list-link">ATE</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/api-documentation/post-processing/CATE" class="nav-list-link">CATE</a> </li><li class="nav-list-item "> <a href="http://localhost:4000/DAME-FLAME-Python-Package/api-documentation/post-processing/ATT" class="nav-list-link">ATT</a> </li></ul></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide" class="nav-list-link">User Guide</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/Introduction" class="nav-list-link">Introduction to Causal Inference</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/to-match-or-not" class="nav-list-link">Whether to use Matching</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/data-requirements" class="nav-list-link">Discrete Observation Requirement</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/documentation/user-guide/Getting-Matches" class="nav-list-link">Getting Matches</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/Treatment-Effects" class="nav-list-link">Treatment Effect Estimates</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/Algorithm-Controls" class="nav-list-link">Algorithm Controls</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/user-guide/Missing-Data" class="nav-list-link">Missing Data Handling</a></li></ul></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples" class="nav-list-link">Examples</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/flame_vs_dame_quality/" class="nav-list-link">Comparing DAME and FLAME</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/early_stopping/" class="nav-list-link">Benefit to Early Stopping</a></li><li class="nav-list-item active"><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/exact_matching/" class="nav-list-link active">Exact Matching Only</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/interpretability/" class="nav-list-link">Interpreting Covariate Importance</a></li><li class="nav-list-item "><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples/natality_experiment/" class="nav-list-link">Natality Experiment</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/DAME-FLAME-Python-Package/FAQ" class="nav-list-link">FAQ and Vocabulary Guide</a></li></ul> </nav> <footer class="site-footer"> This package is created by the <a href="https://almost-matching-exactly.github.io">Almost Matching Exactly Lab</a>. Site based on the Jekyll theme <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>. Copyright Duke University, 2020. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search AME Lab" aria-label="Search AME Lab" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/almost-matching-exactly" class="site-button" rel="noopener noreferrer" > GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/DAME-FLAME-Python-Package/examples">Examples</a></li> <li class="breadcrumb-nav-list-item"><span>Exact Matching Only</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="fs-9" id="exact-matching"> <a href="#exact-matching" class="anchor-heading" aria-labelledby="exact-matching"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exact Matching </h1> <p>The DAME or FLAME algorithm can be configured to be used for exact matching, using the early stopping criteria parameter <code class="language-plaintext highlighter-rouge">early_stop_iterations=1</code>. We illustrate this below. On a dataset with 200 units and five covariates that was generated with little randomness in which most covariate values are the same, we are only interested in exactly matched units. The output generated by the <code class="language-plaintext highlighter-rouge">verbose=3</code> parameter shows that the majority of units are matched after one iteration. We visualize the treatment effect of each group, or the CATE of each group, using matplotlib <a href="#references">[1]</a>. We also visualize the matched groups’ sizes, which shows that one group has the majority of units.</p> <div class="code-example"> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">dame_flame</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>


<span class="n">df</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">dame_flame</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">gen_data_decay_importance</span><span class="p">(</span><span class="n">num_control</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">num_treated</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> 
                    <span class="n">num_cov</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">bernoulli_param</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">bi_mean</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bi_stdev</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">dame_flame</span><span class="p">.</span><span class="n">matching</span><span class="p">.</span><span class="n">FLAME</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">early_stop_iterations</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">holdout_data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="n">groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">units_per_group</span><span class="p">)))</span>
<span class="n">cate_of_group</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">len_group</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="n">units_per_group</span><span class="p">:</span>
    <span class="n">cate_of_group</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">dame_flame</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">post_processing</span><span class="p">.</span><span class="n">CATE</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">group</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">len_group</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
    
    
<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">gridspec_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s">'width_ratios'</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'Treatment Effect of Group'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'Matched group ID number'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Treatment Effect of Each Group of Perfectly Matched Units'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">bar</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span><span class="n">cate_of_group</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">'Number of Units in Group'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">'Matched group ID number'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">set_title</span><span class="p">(</span><span class="s">'Size of Each Group of Perfectly Matched Units'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">bar</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span><span class="n">len_group</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'treatment_effect_size_of_groups.png'</span><span class="p">)</span>
</code></pre></div> </div> </div> <p><img src="https://github.com/nehargupta/dame-flame-experiments/raw/master/treatment_effect_size_of_groups.png" alt="Perfect Matching" title="Perfect Matching" /></p> <p><img src="https://raw.githubusercontent.com/nehargupta/dame-flame-experiments/master/exact_matching_verbos.PNG" alt="Perfect Matching Verbose" title="Perfect Matching Verbose" /></p> <p><a href="https://github.com/nehargupta/dame-flame-experiments/blob/master/exact_matching.ipynb" class="btn btn-primary fs-4 mb-4 mb-md-0">Download Example From GitHub</a></p> <div id="references" class="language-markdown highlighter-rouge"> <h4> References </h4> <a class="number" href="#exact-matching">[1]</a> <a href="https://matplotlib.org/3.3.2/gallery/lines_bars_and_markers/barchart.html#sphx-glr-gallery-lines-bars-and-markers-barchart-py"> Matplotlib: Grouped bar chart with labels </a> </div> </div> </div> <div class="search-overlay"></div> </div> </body> </html> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']], processEscapes: true } }); </script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
